<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HOME</title>
    
    {% load static %}
    <!-- <link href="{% static 'css/output.css' %}" rel="stylesheet"> -->

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Anuphan:wght@100..700&display=swap" rel="stylesheet">
   
    <style>
        
        body,html{
            font-family:"Anuphan", sans-serif;
            background-color: #f0eeee;
        }

        .menu-container {
            width: 200px;
            background-color: #2b3f65;
            color: white;
            height: 94vh;
            display: flex;
            flex-direction: column;
            justify-content: space-between; 
            align-items: center;
            padding: 20px 0;
            position: fixed;
            top: 0;
            left: 0;
            border-radius: 0 40px 40px 0;
        }

        /* Profile section */
        .profile-section {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Profile image */
        .profile-image {
            border-radius: 50%;
            width: 70px;
            height: 70px;
            margin-bottom: 10px;
            border: 2px solid #d1d1d1;
            margin-top: 30px;
        }

        /* Username and user ID */
        .username {
            font-weight: bold;
            font-size: 16px;
            text-align: center;
             margin: 0;
        }

        .userid {
            color: #97a0af;
            font-size: 14px;
            text-align: center;
            margin: 0;
            margin-bottom: 20px;
        }

        .new-event-btn {
            background-color: #ffffff;
            padding: 10px 15px;
            border-radius: 30px;
            color: black;
            font-weight: bold;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 120px; 
            transition: all 0.3s ease;
        }

        .new-event-btn:hover {
            cursor: pointer; 
            transform: scale(1.1); 
        }

        .menu-items {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            width: 100%; 
        }

        .menu-item {
            width: 80%; 
            margin-left: 10px;
            padding: 20px 15px;
            color: white;
            text-align: center;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: background 0.3s;
            margin-bottom: 10px;
            border-radius: 25px 0 0 25px;
        }


        .menu-item.active {
            background-color: #ffffff;
            font-weight: bolder;
            color: #2b3f65;
            border-radius: 25px 0 0 25px;
        }

        .menu-item:hover {
            background-color: #f0eeee;
            color: #1c2b4a;
            font-weight: bold;
            border-radius: 25px 0 0 25px;
            text-align: center;
        }

        i {
            margin-right: 8px;
            /* text-align: center; */
            /* margin: auto; */
        }
        /* Logout button */
        .logout {
            padding: 10px 25px;
            color: #ffffff;
            font-weight: normal;
            display: flex;
            align-items: center;
            border-radius: 20px;
        }

        .logout:hover {
            background-color: #aa3129;
            color: white;
            border-radius: 20px;
            padding: 10px 10px;
            margin: 0;
        }

        .home_page {
            /* background-color: #F59E0B; */
            width: 60%;
            margin-left: 170px;
            border-radius: 25px;
            padding: 20px;
        }

        .home_container {
            background-color: #ffffff;
            width: 90%;
            margin: 5px auto;
            /* border-radius: 25px; */
            text-align: center;
            /* padding: 20px; */
        }

        .search-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0px;
        }

        .search-box {
            width: 100%;
            max-width: 630px;
            margin-right: 50px;
            
        }

        .search-form {
            display: flex;
            align-items: center;
            gap: 10px;
            
        }

        .input-icon {
            position: relative;
            width: 100%;
        }

        .input-icon input {
            width: 100%;
            padding: 10px 15px 10px 40px;
            font-size: 14px;
            border-radius: 20px;
            outline: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            background-color: #ffffff;
        }

        .input-icon i {
            position: absolute;
            top: 50%;
            left: 15px; 
            transform: translateY(-50%);
            color: #8d8d8d;
            font-size: 18px;
            /* cursor: pointer; */
        }

        .input-icon input:focus {
            border-color: #007bff;
            box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
        }

        /* ย้อนกลับค้นหา */
        .clear-button {
            position: absolute;
            top: 50%;
            left: 5px;
            transform: translateY(-50%);
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 18px;
            transition: opacity 0.3s ease, transform 0.3s ease;
            po
        }

        .clear-button {
            display: none;  
        }

        .clear-button.show {
            display: inline-block;
        }

        #search-icon.hide {
            opacity: 0;
            transform: scale(0.8); 
        }

        .clear-button.show i {
            opacity: 1;
            transform: scale(1); 
        }

        .clear-button:hover {
            cursor: pointer; 
        }

        .filter-box {
            background-color: #1d2d63;
            padding: 15px;
            border-radius: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            max-width: 650px;
            margin: 20px auto;
        }

        .filter-item {
            margin-right: 5px;
        }

        .filter-item i {
            margin-right: 10px; /* เพิ่มช่องว่างระหว่างไอคอนและ dropdown */
            font-size: 16px; /* ขนาดไอคอน */
        }

        .filter-dropdown {
            background-color: #fff;
            color: #000;
            border: none;
            border-radius: 30px;
            padding: 10px 10px;
            font-size: 14px;
            width: 120px;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s ease;
            appearance: none;
            cursor: pointer;
            text-align: center;
            margin-left: 20px;
        }

        .filter-dropdown:hover {
            background-color: #f0f0f0;
        }

        .search-btn-container {
            display: flex;
            justify-content: flex-end;
        } 

        .search-btn {
            background-color: #f9a825;
            color: white;
            border: none;
            border-radius: 100%;
            padding: 10px;
            font-size: 14px;
            cursor: pointer;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s ease;
            margin-left: 15px;
        }

        .search-btn:hover {
            background-color: #e58e00;
        } */

        /* Arrow icon for dropdown */
        .filter-dropdown::after {
            content: '\25BC'; /* Unicode for down arrow */
            font-size: 12px;
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
        }

        .feed{
            margin-left: 60px;
            color: #888;
            font-size: 14px;
            margin-top: 20px;
            margin-bottom: 0px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fff;
            margin: 10% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 40%;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            position: relative;
            text-align: center;
        }

        .close {
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 25px;
            cursor: pointer;
        }
        
        .close:hover,
        .close:focus {
            color: rgb(211, 49, 49);
            cursor: pointer;
        }

        .modal.active {
            display: flex;

    justify-content: center; 
    align-items: center;

        }


        /* .btn {
            padding: 10px 20px;
            background-color: #5e5e5e;
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
        } */

        .event-container {
            margin-top: 20px;
        }

        .post-box{
            display: flex;
        }
        .event-post {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            /* border: 1px solid #ccc; */
            border-radius: 15px;
            margin-bottom: 20px;
            background-color: #fff;
            width: 100%;
            max-width: 650px;   
            min-width: 650px;   
            min-height: 200px;
            overflow: hidden;   
            margin: auto;
            margin-top: 20px;
        }

        .post-left {
            display: flex;
            flex-direction: column;
            gap: 0px;
            flex-grow: 1;
            /* border: 1px solid #ad2e2e; */
            width: 100%;
            max-width: 400px;
            margin-left: 30px;
            overflow: hidden;  
        }

        
        .post_member {
            display: flex;
            gap: 10px; 
            margin: 10px;
            padding: 20px 0;
            /* line-height: 15px;  */
        }

        .member-info {
            display: flex;
            flex-direction: column;
        }

        .username-container {
            display: flex;
            align-items: center; 
            gap: 5px; 
        }

        .username-post {
            font-weight: bold;
            font-size: 16px;
            margin: 0;
        }

        .userid-post {
            font-size: 14px;
            color: #797979;
            margin: 0;
        }

        .location-icon {
            color:  #ec2727;
            font-size: 14px; 
            margin-right: 5px; 
            margin-left: 5px;
        }

        .location {
            font-size: 13px;
            margin: 0;
            color:  #888;
            margin-top: 5px; 
            font-weight: normal;
        }

        .location a {
            color: red;
            text-decoration: none;
            font-weight: bold;
        }

        .location a:hover {
            text-decoration: underline;
        }
        
        .detail-post {
            /* border: 1px solid #ca1b96; */
            line-height: 10px;
            color: #000;
            margin-left: 14px;
        }

        .detail-post h2 {
            font-size: 18px;
            font-weight: bolder;
            line-height: 5px;
            margin-top: 10px;
        }

        .detail-post p {
            font-size: 13px;
            font-weight: normal;
            line-height: 15px;
            margin-top: 10px;
        }

        .filter-box-post {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            /* margin-top: 10px; */
            /* border: 1px solid #22abd4; */
            margin-left: 15px;
            margin-bottom: 30px;
            
        }

        .filter-box-post > div {
            display: flex;
            align-items: center;
            padding: 0px 0px; 
            background-color: #ffffff;
            /* border: 1px solid #646464; */
            border-radius: 40px;
            font-weight: bold;
            font-size: 12px;
        }

        /* ไอคอนสำหรับแต่ละ dropdown */
        .filter-item i {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #000;
            font-size: 18px;
        }


        /* Arrow icon for dropdown */
        .filter-dropdown::after {
            content: '\25BC';
            font-size: 12px;
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
        }
        .post-right {
            display: flex;
            flex-direction: column;  
            justify-content: flex-start;  
            height: 30vh;  
            width: 40%;
            /* border: 1px solid #d33636; */
            padding: 0px  0px  30px 0px; 
        } 
        .dropdown {
            position: relative; 
            display: flex; 
            justify-content: flex-end;
            align-items: center; 
            margin-right: 30px;
        }

        .dropdown-menu {
            display: none; 
            position: absolute; 
            background-color: white; 
            /* z-index: 1000;  */
            min-width: 50px; 
            right: 0; 
            top: 100%; 
        }

        .dropdown-item {
            display: block; 
            padding: 5px 15px; 
            color: #333; 
            text-align: left; 
            width: 100%; 
            font-size: 14px; 
            background-color: #ffffff; 
            border: 1px solid #c9c9c9; 
            border-radius: 5px; 
            transition: background-color 0.2s ease, color 0.2s ease; 
        }

        .dropdown-item:hover {
            background-color: #213670; 
            color: #ffffff; 
            border-color: #213670; 
            cursor: pointer; 
        }


        .join-btn-container {
            display: flex;
            align-items: center;
            justify-content: center;
            /* flex-shrink: 0; */
            /* margin-left: 20px; */
            /* border: 1px solid #000000; */
            margin-right: 50px;
            margin-top: 25px;
        }

        .join-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: #4CAF50;
            color: white;
            padding: 10px;
            border: 2px solid #000000;
            border-radius: 50%;
            width: 150px;
            height: 150px;
            cursor: pointer;
            text-align: center;
            line-height: 5px;
        }

        .join-btn:hover {
            background-color: #45a049;
        }

        .join-btn h1 {
            /* margin-top: 5px; */
            color: #ffffff;
            font-size: 30px;
            font-weight: bold;
        }

        .join-btn p {
            margin: 0;
            color: #ffffff;
            font-weight: normal;
            font-size: 12px;
        }


        .date, .time, .category, .participants ,.province {
            background-color: #ffffff;
            color: rgb(0, 0, 0);
            /* padding: 0px;  */
            border: 1px solid #646464;
            border-radius: 20px;
            text-align: center;
            display: flex; 
            align-items: center;
            justify-content: center; 
            font-weight: bold;
            font-size: 13px;
        }

        .date {
            width: 45%; 
            font-weight: bold;
        }

        .time {
            width: 15%; 
            font-weight: bold;
        }

        .category {
            width: 25%; 
            font-weight: bold;
        }

        .participants {
            width: 15%; 
            font-weight: bold;
        }


        .province {
            width:auto; 
            padding-right: 30px;
            font-weight: bold;
        }
 
        .profile-image-post {
            border-radius: 50%;
            width: 50px;
            height: 50px;
            border: 1px solid #000000;
        }




        .no_event{
            text-align: center;
            color: #777777;
            font-size: 12px;
        }
  
        .button-container {
            margin-top: 20px;
            display: flex;
            justify-content: center; /* จัดให้อยู่กึ่งกลางแนวนอน */
            align-items: center; /* จัดให้อยู่กึ่งกลางแนวตั้ง (ถ้าจำเป็น) */
            gap: 10px; /* ระยะห่างระหว่างปุ่ม */
        }


    .btn {
        padding: 10px 20px;
        border-radius: 5px;
        border: none;
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
        transition: background-color 0.3s ease;
        gap: 0;
    }

    .btn-yes {
        background-color: #2d7e23;
        color: white;
    }

    /* .btn-yes:hover {
        background-color: #c0392b;
    } */

    .btn-no {
        background-color:  #c0392b;
        color: white;
    }
/* 
    .btn-no:hover {
        background-color: #95a5a6;
    } */


    </style>
</head>

<body>

    <!-- เมนู -->
    <div class="menu-container">
        <div class="profile-section">
            <img src="{{ member_data.profile.url }}" alt="Profile Image" class="profile-image">
            <p class="username">{{ member_data.username }}</p>
            <p class="userid">{{ member_data.userid }}</p>
            <button id="openModal" class="new-event-btn">+ New Event</button>
        </div>

        <div class="menu-items">
            <a class="menu-item home-btt active" href="{% url 'home' %}">
                <i class="fas fa-home"></i> Home
            </a>
            <a class="menu-item profile-btt" href="{% url 'profile' %}">
                <i class="fas fa-user"></i> Profile
            </a>
            <a class="menu-item chat-btt" href="{% url 'chat' %}">
                <i class="fas fa-comment"></i> Chat
            </a>
            
        </div>

        <a href="{% url 'logout' %}" class="logout">
            Logout
        </a>
    </div>


    <div class="home_page" id="home_page">



        <!-- ค้นหาแบบข้อความ -->
        <div class="search-container">
            
            <div class="search-box">
                <form method="get" action="{% url 'search_events' %}" class="search-form">
                    <div class="input-icon">
                        <i class="fas fa-search" id="search-icon"></i> 
                        <input 
                            type="text" 
                            name="query" 
                            value="{{ query }}" 
                            placeholder="Search events..." 
                            class="form-control" 
                            id="search-input"
                            oninput="toggleClearButton()"  
                        >
                        <!-- ปุ่มล้างคำค้นหาที่จะปรากฏเมื่อมีการกรอกคำค้น -->
                        <button type="button" class="clear-button" id="clear-button" onclick="clearSearch()" style="display: none;">
                            <i class="fa-solid fa-chevron-left"></i>
                        </button>
                    </div>
                </form>
                



            </div>
        </div>
        
    
<!-- 
        <div class="filter-box">
             
            <div class="filter-item">
                <select name="province" class="filter-dropdown location-dropdown">
                    <option value="" selected disabled>เลือกจังหวัด</option>
                    {% for value, label in province_choices %}
                        <option value="{{ value }}" {% if request.GET.province == value %}selected{% endif %}>
                            {{ label }}
                        </option>
                    {% endfor %}
                </select>
            </div>
        
            
            <div class="filter-item">
                <select name="max_participants" class="filter-dropdown people-dropdown">
                    <option value="" selected disabled>จำนวนคน</option>
                    {% for i in max_participants_range %}
                        <option value="{{ i }}" {% if request.GET.max_participants == i|stringformat:"s" %}selected{% endif %}>
                            {{ i }} คน
                        </option>
                    {% endfor %}
                </select>
            </div>
        
            
            <div class="filter-item">
                <select name="category" class="filter-dropdown category-dropdown">
                    <option value="" selected disabled>เลือกหมวด</option>
                    {% for value, label in category_choices %}
                        <option value="{{ value }}" {% if request.GET.category == value %}selected{% endif %}>
                            {{ label }}
                        </option>
                    {% endfor %}
                </select>
            </div>
        
            
            <div class="search-btn-container">
                <button type="submit" class="search-btn">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </div>
         -->
        
        

        <p class="feed">feed now</p>

    <!-- post event -->
        <div class="event-container">
            {% for event in events %}
            <div class="event-post">
                
                <!-- Profile and Event Details -->
                <div class="post-left">

                    <!-- รายละเอียดผู้โพสต์ -->
                    <div class="post_member">
                        <img src="{{ event.created_by.profile.url }}" alt="Profile Image" class="profile-image-post">
                        <div class="member-info">
                            <div class="username-container">
                                <p class="username-post">{{event.created_by.username }}</p>
                            </div>

                            <p class="location">
                                <strong>กำลังจะไปที่... </strong>
                                <i class="fa-solid fa-location-dot location-icon"></i>
                                <a href="https://www.google.com/maps/search/?api=1&query={{ event.location }}" target="_blank">{{ event.location }}</a>
                            </p>
                            
                            
                        </div>
                    </div>
                      
                    <!-- รายละเอียดอีเวนต์ -->
                    <div class="detail-post">
                        <h2>{{ event.event_name }}</h2>
                        <p>{{ event.event_title }}</p>
                    </div>

                    <!-- <div class="time-since-created">
                        <i class="fa-solid fa-clock"></i>
                        <p>โพสต์เมื่อ {{ event.created_at }} </p>
                    </div> -->

                    <!-- รายละเอียดเพิ่มเติม (วัน, หมวดหมู่, จังหวัด) -->
                    <div class="filter-box-post">
                        <div class="date">
                            <i class="fa-solid fa-calendar-days"></i>
                            <p>: {{ event.event_datetime }}</p>
                        </div>
                        <div class="participants">
                            <i class="fa-solid fa-user"></i>
                            <p>: {{ event.max_participants }}</p>
                        </div>
                        <div class="category">
                            <i class="fa-solid fa-shapes"></i>
                            <p>: {{ event.category }}</p>
                        </div>
                        <div class="province">
                            <i class="fa-solid fa-location-dot"></i>
                            <p>: {{ event.province }}</p>
                        </div>
                    </div>
                </div>

 
    <div class="post-right">
        <div class="dropdown">
            <i class="fa-solid fa-ellipsis-vertical" onclick="toggleDropdownMenu('{{ event.id }}')" style="cursor: pointer;"></i>
            <div class="dropdown-menu" id="dropdownMenu-{{ event.id }}">
                <!-- <button class="dropdown-item" onclick="openEditModal('{{ event.id }}', '{{ event.event_name }}', '{{ event.event_title }}', '{{ event.event_datetime|date:'Y-m-d\TH:i' }}', '{{ event.location }}', '{{ event.category }}', '{{ event.participants }}', '{{ event.province }}')">Edit</button> -->
                <form id="editEventForm{{ event.id }}" method="POST" style="display:inline;">
                    {% csrf_token %}
                    <!-- <button type="button" class="dropdown-item" onclick="openeditEventModal('{{ event.id }}')">Edit</button> -->
                    {% if event.id %}
                        <!-- <button class="edit-event-btn" data-event-id="{{ event.id }}">Edit</button> -->
                    
                        <button class="dropdown-item" onclick="openEditModal('{{ event.id }}')">Edit</button>  
                    {% else %}
                        <p>No event id</p>
                    {% endif %} 


                </form>

                <form id="deleteForm-{{ event.id }}" method="POST" action="{% url 'delete_event' event.id %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="button" class="dropdown-item" onclick="openConfirmDeleteModal('{{ event.id }}')">Delete</button>
                </form>
            </div>
            
         

        </div>
    
     
        
        <!-- Popup container -->
        <div id="popup-container"></div>
        
        

    <!-- ปุ่ม JOIN ด้านขวา -->
        <div class="join-btn-container">
            <button class="join-btn">
                <p>i want to</p>
                <h1>JOIN</h1>
                <p>{{ event.participants }}/{{ event.max_participants }}</p>
            </button>
        </div>
    </div>
 

</div>
</div>
        <!-- ถ้าไม่มีอีเว้น-->
        <div>
            {% empty %}
            <p class="no_event"> - No events available - </p>
            {% endfor %}
        </div>



        <div id="eventModal" class="modal">
            {% include 'member/new_event.html' %}
        </div>

       <!-- Modal HTML -->

<div id="editEventModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeEditEventModal()">&times;</span>
        <h2>Edit Event Details</h2>

       
        <form method="post" id="updateEventForm">
            {% csrf_token %}
            
            <!-- ใส่ค่า event.id ใน hidden input -->
            <input type="hidden" name="event_id" value="{{ event.id }}">
            
            {{ form.as_p }}
            <button type="submit" class="btn btn-primary">Save Changes</button>
        </form>
        
    </div>
</div>


        <!-- <div id="editEventModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeEditEventModal()">&times;</span>
                <h2>Edit Event Details</h2>
        
                
                <form method="post" id="updateEventForm">
                    {% csrf_token %}
                    {{ form.as_p }}
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </form>
                
            </div>
        </div> -->
   

        

          
             <!-- ป๊อปอัพยืนยันการลบ -->
             <div id="confirmDeleteModal" class="modal">
                <div class="modal-content">
                    <span class="close" onclick="closeConfirmDeleteModal()">&times;</span>
                    <h2>Are you sure to delete ?</h2>
                    <div class="button-container">
                        <button id="confirmDeleteBtn" class="btn btn-yes">Yes</button>
                        <button class="btn btn-no" onclick="closeConfirmDeleteModal()">No</button>
                    </div>
                </div>
            </div>

        <div>
            {% include 'member/notification.html' %}
        </div>

   

</div>

<script>
    const formData = new FormData(document.getElementById('EventForm'));

// ตรวจสอบว่าฟอร์มเก็บค่าทั้งหมด
for (let pair of formData.entries()) {
    console.log(pair[0] + ': ' + pair[1]);
}

</script>

<!-- แก้ไขอีเว้น -->

<script>
    function openEditEventModal() {
    const modal = document.getElementById("editEventModal");
    modal.style.display = "block";  // เปิด modal

    const form = document.getElementById("updateEventForm");
    form.addEventListener("submit", function(event) {
        event.preventDefault();  // ป้องกันการส่งฟอร์มโดยอัตโนมัติ

        const formData = new FormData(form);
        fetch(form.action, {
            method: 'POST',
            body: formData,
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                modal.style.display = "none";  // ปิด modal
                window.location.reload();  // รีเฟรชหน้าเว็บ
            }
        })
        .catch(error => console.error('Error:', error));
    });
}

function closeEditEventModal() {
    const modal = document.getElementById("editEventModal");
    modal.style.display = "none";  // ปิด modal
}

</script>
<!-- <script>
// ฟังก์ชันเปิด modal
function openEditEventModal() {
    document.getElementById("editEventModal").style.display = "block";
}

// ฟังก์ชันปิด modal
function closeEditEventModal() {
    document.getElementById("editEventModal").style.display = "none";
}

// การปิด modal ด้วยการคลิกที่ปุ่มปิด (X)
window.onclick = function(event) {
    if (event.target === document.getElementById("editEventModal")) {
        closeEditEventModal();
    }
}

</script> -->


<!-- เปลี่ยนไอคอนเป็นย้อนกลับ -->
<script>
    const searchInput = document.getElementById('search-input');
    const searchIcon = document.getElementById('search-icon');
    const clearButton = document.getElementById('clear-button');

    // ฟังก์ชันตรวจสอบการกรอกคำค้นหา
    function toggleClearButton() {
        if (searchInput.value) {
            // ถ้ามีคำค้นหาจะซ่อนไอคอนค้นหาและแสดงไอคอนล้าง
            searchIcon.style.display = 'none';
            clearButton.style.display = 'inline-block';
        } else {
            // ถ้าไม่มีคำค้นหาจะแสดงไอคอนค้นหากลับ
            searchIcon.style.display = 'inline-block';
            clearButton.style.display = 'none';
        }
    }

    // ฟังก์ชันล้างคำค้น
    function clearSearch() {
        searchInput.value = '';  // เคลียร์คำค้นหา
        searchInput.focus();  // ตั้งโฟกัสที่ช่อง input
        searchIcon.style.display = 'inline-block';  // แสดงไอคอนค้นหา
        clearButton.style.display = 'none';  // ซ่อนไอคอนล้าง
        // รีเฟรชหน้าหลัก
        document.querySelector('.search-form').submit();
    }

    // เรียกฟังก์ชันเพื่อให้มีการเปลี่ยนไอคอนตั้งแต่เริ่มต้น
    toggleClearButton();
</script>

<!-- new_event -->
<script>
    const openModal = document.getElementById("openModal");
    const modal = document.getElementById("eventModal");
    const closeModal = document.querySelector(".close");
    const eventForm = document.getElementById('eventForm');
    const homePageDiv = document.getElementById('home_page');

    openModal.onclick = function() {
        modal.classList.add("active");
    }

    closeModal.onclick = function() {
        modal.classList.remove("active");
    }

    window.onclick = function(event) {
        if (event.target == modal) {
            modal.classList.remove("active");
        }
    }

    eventForm.addEventListener('submit', function(e) {
        e.preventDefault();  // ป้องกันการส่งฟอร์มแบบปกติ

        const formData = new FormData(eventForm);
        fetch("{% url 'new_event' %}", {
            method: 'POST',
            body: formData,
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
            },
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                modal.classList.remove("active");  // ปิด pop-up
                window.location.reload();  // รีเฟรชหน้าเว็บเพื่อแสดง Event ใหม่
            }
        })
        .catch(error => console.log('Error:', error));
    });
</script>



<!-- แก้ไขอีเว้น -->
<script>
    // ฟังก์ชันที่ใช้เปิด modal สำหรับการแก้ไข
function openEditModal(eventId) {
    const modal = document.getElementById("eventModal");
    const eventForm = document.getElementById('eventForm');
    const updateUrl = `/edit-event/${eventId}/`; // URL สำหรับการแก้ไข Event

    // เรียกข้อมูลของฟอร์มจาก server
    fetch(updateUrl, {
        method: 'GET',
        headers: {
            'X-Requested-With': 'XMLHttpRequest',
        },
    })
    .then(response => response.text())
    .then(html => {
        modal.innerHTML = html;  // ใส่ HTML ของฟอร์มเข้าไปใน modal
        modal.classList.add("active");  // แสดง modal

        // ตั้งค่า event listener สำหรับฟอร์ม
        eventForm.addEventListener('submit', function(e) {
            e.preventDefault();  // ป้องกันการส่งฟอร์มแบบปกติ

            const formData = new FormData(eventForm);
            fetch(updateUrl, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                },
            })

            
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    modal.classList.remove("active");  // ปิด modal
                    window.location.reload();  // รีเฟรชหน้าเว็บ
                } else {
                    // แสดง error ในกรณีที่เกิดปัญหากับฟอร์ม
                    console.log(data.errors);
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        });
    })
    .catch(error => {
        console.error('Error:', error);
    });
}

</script>

<!-- ใช้ moment.js คำนวณเวลา ว่าโพสมานานยัง -->
<!-- <script>
    document.querySelectorAll('.time-since-created').forEach(function(element) {
        const createdAt = element.getAttribute('data-created');
        const timeDisplay = element.querySelector('.time-display');
        timeDisplay.textContent = moment(createdAt).fromNow(); 
    });
</script> -->


        <script>
            // เปิด modal สำหรับแก้ไข event
            function toggleDropdownMenu(eventId) {
            // Log เพื่อดูว่า function ถูกเรียกใช้หรือไม่
            console.log("Toggling dropdown for event:", eventId);
            var dropdown = document.getElementById("dropdownMenu-" + eventId);
            dropdown.style.display = (dropdown.style.display === "block") ? "none" : "block";
        }

            // ปิด dropdown เมื่อลงคลิกนอก dropdown
            window.onclick = function(event) {
                if (!event.target.closest('.dropdown')) {
                    document.querySelectorAll('.dropdown-menu').forEach(function(menu) {
                        menu.style.display = "none";
                    });
                }
            };
            </script>

<script>
function openEditModal(eventId) {
    // ตั้งค่า action URL สำหรับฟอร์มแก้ไข event
    const modal = document.getElementById('editEventModal');
    modal.classList.add("active");  // แสดง modal

    // ดึงข้อมูลกิจกรรมที่ต้องการแก้ไข
    fetch(`/update_event/${eventId}/`)
        .then(response => response.json())
        .then(data => {
            // ตั้งค่าฟิลด์ในฟอร์มด้วยข้อมูลที่ได้
            document.getElementById('edit_event_name').value = data.event_name;
            document.getElementById('edit_event_title').value = data.event_title;
            document.getElementById('edit_event_datetime').value = data.event_datetime;
            document.getElementById('edit_location').value = data.location;
            document.getElementById('edit_category').value = data.category;
            document.getElementById('edit_max_participants').value = data.participants;
            document.getElementById('edit_province').value = data.province;

            // กำหนด action ของฟอร์มให้ถูกต้อง
            document.getElementById('editEventForm').action = `/update_event/${eventId}/`;
        })
        .catch(error => console.error('Error:', error));
}

function closeModal() {
    const modal = document.getElementById('editEventModal');
    modal.classList.remove("active");
}

</script>

    </script>

<script>
        let deleteEventId = null;

    function openConfirmDeleteModal(eventId) {
        deleteEventId = eventId;
        document.getElementById('confirmDeleteModal').classList.add('active');
    }

    function closeConfirmDeleteModal() {
        deleteEventId = null;
        document.getElementById('confirmDeleteModal').classList.remove('active');
    }

    document.getElementById('confirmDeleteBtn').addEventListener('click', function() {
        if (deleteEventId) {
            // ส่งฟอร์มเพื่อทำการลบ event
            const deleteForm = document.getElementById('deleteForm-' + deleteEventId);
            deleteForm.submit();
        }
    });

</script>

</body>
</html>
